<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Scanner Ticket ‚Üí Google Sheets</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Styles de l'app -->
  <link rel="stylesheet" href="assets/css/app.css"/>

  <!-- OCR + Pr√©traitement image -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script async src="https://docs.opencv.org/4.x/opencv.js" onload="window._opencvReady=true"></script>

  <!-- Google Identity Services + gapi -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js" async defer></script>
</head>
<body>
  <div class="container-fluid px-2 px-md-3 py-3 pb-4">
    <header class="mb-3">
      <div class="row align-items-center g-2">
        <div class="col-12 text-center">
          <h1 class="h5 mb-1"><u>Ticket scanner</u></h1>
          <div id="authRow" class="d-inline-flex align-items-center gap-2">
            <button id="btnAuth" class="btn btn-outline-light btn-sm" style="display:none">Se connecter √† Google</button>
            <span id="authStatus" class="text-muted small">Connexion‚Ä¶</span>
          </div>
        </div>

        <div class="col-12 mt-3 d-flex flex-column flex-lg-row align-items-center justify-content-center gap-2">
          <label for="sheetSelect" class="form-label mb-0 fw-bold" style="white-space:nowrap;font-size:18px;">
            Feuille de calcul :
          </label>
          <select id="sheetSelect" class="form-select" style="max-width: 280px;"></select>
        </div>
      </div>
    </header>

    <div class="card shadow-sm p-3 p-lg-4">
      <div class="row g-4">
        <!-- IMAGE -->
        <div class="col-12 col-lg-6">
          <div class="mb-2">
            <label for="file" class="form-label fw-semibold">Photo du ticket</label>
            <div class="d-grid gap-2">
              <label for="file" class="btn btn-primary">üì∑ Prendre une photo</label>
            </div>
            <input id="file" type="file" accept="image/*" capture="environment"/>
            <div class="form-text text-muted">Astuce : ticket bien √† plat, lumi√®re homog√®ne, cadre serr√©.</div>
          </div>

          <div class="preview-box">
            <img id="preview" alt="Pr√©visualisation"/>
          </div>
        </div>

        <!-- FORM -->
        <div class="col-12 col-lg-6">
          <div class="mb-3">
            <label class="form-label fw-semibold">Qui scanne ?</label>
            <div class="btn-group w-100" role="group" aria-label="Qui scanne">
              <input type="radio" class="btn-check" name="who" id="who-sab" autocomplete="off" value="Sabrina">
              <label class="btn btn-outline-light" for="who-sab">Sabrina</label>

              <input type="radio" class="btn-check" name="who" id="who-mick" autocomplete="off" value="Mickael" checked>
              <label class="btn btn-outline-light" for="who-mick">Mickael</label>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Intitul√© (enseigne)</label>
            <input id="merchant" type="text" class="form-control" placeholder="Ex : ASF, CARREFOUR CITY"/>
            <div id="merchantCandidates" class="suggestions"></div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Date</label>
            <input id="date" type="text" inputmode="numeric" class="form-control" placeholder="jj/mm/aaaa"/>
            <div id="dateCandidates" class="suggestions"></div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Total (‚Ç¨)</label>
            <input id="total" type="text" inputmode="decimal" class="form-control" placeholder="Ex : 162,05"/>
            <div id="totalCandidates" class="suggestions"></div>
            <div class="form-text text-muted">Enregistr√© en <b>monnaie ‚Ç¨</b> (nombre format√©).</div>
          </div>

          <!-- Boutons (dans le flux, sous Total) -->
          <div class="actions-mobile">
            <button class="btn btn-success" id="btnSave" disabled>Enregistrer dans le Google Sheet</button>
            <button class="btn btn-danger" id="btnReset">R√©initialiser</button>
          </div>
        </div>
      </div>

      <div class="mt-3 statusbar" id="status">Pr√™t.</div>
    </div>
  </div>

  <!-- Code de l'app -->
  <script src="assets/js/app.js"></script>
</body>
</html>
